<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Eras Tour on Data</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        /* 新增全页面滚动容器 */
        .scroll-wrapper {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
        }
        
        /* 修改所有screen类为滚动吸附点 */
        .cover-container,
        .screen-intro,
        .screen-albums,
        .screen-overview {
            height: 100vh;
            width: 100vw;
            scroll-snap-align: start;
        }

        /* 全屏封面容器 - 默认显示横版图 */
        .cover-container {
            height: 100vh;
            width: 100vw;
            background: 
                linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)),
                url('https://www.taylorswift.com/wp-content/uploads/sites/2529/2024/12/img-fearless-compressed.jpg') center/cover no-repeat;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }
        
        /* 移动端竖版图 */
        @media (max-width: 768px) and (orientation: portrait) {
            .cover-container {
                background: 
                    linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)),
                    url('https://assets.dmi.umgapps.com/assets/taylor-swift/landing-images/1678544276252-2-v2.jpg') center/cover no-repeat;
            }
        }
        
        /* 标题样式 */
        .cover-title {
            max-width: 800px;
        }
        
        .cover-title h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .cover-title p {
            font-size: clamp(1.2rem, 2.5vw, 1.8rem);
            opacity: 0.9;
            font-weight: 300;
            text-shadow: 0 1px 5px rgba(0,0,0,0.3);
        }
        
        /* 滚动提示 */
        .scroll-hint {
            position: absolute;
            bottom: 30px;
            animation: bounce 2s infinite;
        }

        /* 当页面滚动到第二页时 */
        body.scrolled .scroll-hint {
        color: black;
        text-shadow: 0 1px 3px rgba(255,255,255,0.3);
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }

    </style>
    <style>@import url("css/page2.css");</style>
    <style>@import url("css/page3.css");</style>
    <style>@import url("css/page4.css");</style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="scroll-wrapper">
    <div class="cover-container">
        <div class="cover-title">
            <h1>The Eras Tour on Data</h1>
            <p>用数据穿越 Taylor Swift 的音乐纪元</p>
        </div>
        <div class="scroll-hint">
            ↓ 向下滚动 ↓
        </div>
    </div>

    <section class="screen-intro">
        <div class="intro-container">
            <div class="intro-content">
                <h2>Introduction</h2>
                <p class="full-text">泰勒·斯威夫特 (Taylor Swift) 是21世纪最具影响力的音乐人之一，拥有11张录音室专辑，全球销量超过2亿张。她的音乐跨越乡村、流行、民谣等多种风格，获得12座格莱美奖，创下多项音乐行业纪录。</p>
                <p class="full-text">2025年5月，Taylor Swift 以3.6亿美元的价格成功回购了她前六张专辑的母带版权，结束了与 Big Machine 公司长达六年的版权斗争。这一举动标志着她重新获得了对自己全部音乐作品的控制权，成为艺术家自主权的里程碑事件。</p>
                <p class="full-text">她的"Eras Tour"巡演成为史上最成功的商业巡演，总收入超过20.77亿美元，远超此前纪录保持者。最新专辑《The Tortured Poets Department》（苦难诗社）于2024年发行后继续打破多项销售纪录。</p>
                <p class="full-text">下面，让我们一起来走进这场 Eras Tour on Data，探索 Taylor Swift 从乡村音乐少女到流行天后的蜕变历程，用数据揭示她音乐宇宙中的创作密码与时代印记。</p>
                <p class="short-text">Taylor Swift 是21世纪最具影响力的音乐人之一，拥有11张录音室专辑，全球销量超过2亿张。她的音乐跨越乡村、流行、民谣等多种风格，获得12座格莱美奖，创下多项音乐行业纪录。</p>
                <p class="short-text">下面，让我们一起来走进这场 Eras Tour on Data，探索 Taylor Swift 从乡村音乐少女到流行天后的蜕变历程，用数据揭示她音乐宇宙中的创作密码与时代印记。</p>
            </div>
            <div class="intro-image">
                <!-- 替换为你的图片路径 -->
                <img src="https://www.taylorswift.com/wp-content/uploads/sites/2529/2025/06/tletter1-768x768.png" alt="Taylor Swift">
            </div>
        </div>
    </section>

    <section class="screen-albums">
        <div class="albums-title">
            <h2>The Eras Collection</h2>
            <p>点击专辑标志查看封面。注：TV 代表 Taylor's Version。为了夺回原始专辑的版权，Taylor 选择重录旧作。</p>
        </div>
        
        <div class="albums-grid">
            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Taylor-Swift.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Taylor Swift</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Taylor-Swift.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Fearless.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Fearless</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Fearless.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Speak-Now.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Speak Now</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Speak-Now.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Red.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Red</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Red.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-1989.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">1989</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-1989.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Reputation.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Reputation</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Reputation.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Lover.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Lover</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Lover.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Folklore.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Folklore</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Folklore.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Evermore.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Evermore</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Evermore.png" 
                            alt="Taylor Swift"
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>


            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Fearless-TV.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Fearless (TV)</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Fearless-TV.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Red-TV.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Red (TV)</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Red-TV.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Midnights.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Midnights</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Midnights.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            
            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-Speak-Now-TV.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">Speak Now (TV)</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-Speak-Now-TV.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>


            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-1989-TV.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">1989 (TV)</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-1989-TV.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>


            <div class="album-card" data-album="taylor-swift">
                <div class="album-card-inner">
                    <div class="album-card-front">
                        <img src="img/logo-TTPD.png" 
                            alt="Taylor Swift" 
                            class="album-logo">
                        <p class="album-name">TTPD</p>
                    </div>
                    <div class="album-card-back">
                        <img src="img/img-TTPD.png" 
                            alt="Taylor Swift" 
                            class="album-cover"
                            note="">
                    </div>
                </div>
            </div>

            <!-- 复制上面的div，替换为其他14个专辑 -->
        </div>
    </section>

    <section class="screen-overview">
        <div class="overview-title">
            <h2>Number of Songs</h2>
            <p>专辑歌曲数量分布。共收录了Taylor Swift 11张专辑的230首歌曲（将Taylor's Version和原曲合并）。2024年 TTPD专辑包含的曲目数量最多。</p>
        </div>
        
        <div class="visualization-container">
            <div id="pie-chart" class="chart"></div>
            <div id="bar-chart" class="chart"></div>
        </div>
    </section>

    </div>

    <script>
        
    const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("position", "absolute")
        .style("visibility", "hidden")
        .style("padding", "8px")
        .style("background", "rgba(0,0,0,0.8)")
        .style("color", "white")
        .style("border-radius", "4px")
        .style("pointer-events", "none")
        .style("font-size", "14px")
        .style("z-index", "10");
    
    // 添加IntersectionObserver监听
    const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        const scrollHint = document.querySelector('.scroll-hint');
        if (entry.isIntersecting && (entry.target.classList.contains('screen-intro')||entry.target.classList.contains('screen-albums')
    ||entry.target.classList.contains('screen-overview'))) {
        scrollHint.style.color = 'black';
        } else {
        scrollHint.style.color = 'white';
        }
    });
    }, { threshold: 0.5 });

    // 监听第二页
    observer.observe(document.querySelector('.screen-intro'));
    observer.observe(document.querySelector('.screen-albums'));
    observer.observe(document.querySelector('.screen-overview'));
    </script>

    <script>
        // 专辑翻牌效果
        document.querySelectorAll('.album-card').forEach(card => {
            card.addEventListener('click', function() {
                this.classList.toggle('flipped');
            });
        });
    </script>


    <script>
        // 在现有script后添加
const albumColors = {
    "Taylor Swift": "#1D4737", // 首专红
    "Fearless": "#CBA863",    // 金色
    "Speak Now": "#833C63",   // 紫色
    "Red": "#A91E47",         // 正红
    "1989": "#846578",        // 道奇蓝
    "Reputation": "#2C2C2C",  // 黑色
    "Lover": "#EBBED3",       // 浅粉
    "Folklore": "#949494",    // 灰色
    "Evermore": "#421E18",    // 马鞍棕
    "Fearless (TV)": "#624324", // 同Fearless
    "Red (TV)": "#731803",      // 同Red
    "Midnights": "#5A658B",    // 午夜蓝
    "Speak Now (TV)": "#4a2454", // 同Speak Now
    "1989 (TV)": "#8BB5D2",     // 同1989
    "TTPD": "#1C160F"          // 勃艮第红
};



document.addEventListener('DOMContentLoaded', function() {
    // 加载数据
    d3.tsv("https://calvinxiaocao.github.io/taylor-swift/data/cots-album-details.tsv").then(function(data) {
            data.forEach(d => {
            if(d.Title === "The Tortured Poets Department") {
                d.Title = "TTPD";
            }
        });
        // 过滤掉"Other Songs"
        const albumData = data.filter(d => d.Title !== "Other Songs");

        
        // 转换数据类型
        albumData.forEach(d => {
            d.Songs = +d.Songs;
            d.Lines = +d.Lines;
            d.Words = +d.Words;
        });
        
        // 按歌曲数量排序
        albumData.sort((a, b) => b.Songs - a.Songs);
        
        // 创建饼图
        createPieChart(albumData);
        
        // 创建柱状图
        createBarChart(albumData);
    });
});

function createPieChart(data) {
    const width = window.innerWidth < 768 ? 200 : 400;
    const height = window.innerWidth < 768 ? 250 : 400;
    const radius = Math.min(width, height) / 2;
    
    const svg = d3.select("#pie-chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", `translate(${width/2},${height/2})`);
    

    const color = d3.scaleOrdinal()
    .domain(data.map(d => d.Title))
    .range(data.map(d => albumColors[d.Title] || "#999999"));
    
    // 饼图生成器
    const pie = d3.pie()
        .value(d => d.Songs)
        .sort(null);
    
    // 弧生成器
    const arc = d3.arc()
        .innerRadius(0)
        .outerRadius(radius);
    
    // 创建弧
    const arcs = svg.selectAll("arc")
        .data(pie(data))
        .enter()
        .append("g")
        .attr("class", "arc");
    
    // 添加路径
    arcs.append("path")
        .attr("d", arc)
        .attr("fill", d => color(d.data.Title))
        .attr("stroke", "white")
        .attr("stroke-width", 2)
        // .attrTween("d", function(d) {
        //     const interpolate = d3.interpolate({startAngle: 0, endAngle: 0}, d);
        //     return function(t) {
        //         return arc(interpolate(t));
        //     };
        // })
        .on("mouseover", function(event, d) {
            d3.select(this)
                .attr("stroke-width", 4)
                .attr("stroke", "#333");
            
            tooltip.html(`${d.data.Title}<br>${d.data.Songs}首`)
                .style("visibility", "visible");
        })
        .on("mousemove", function(event) {
            tooltip.style("top", `${event.pageY - 10}px`)
                .style("left", `${event.pageX + 10}px`);
        })
        .on("mouseout", function() {
            d3.select(this)
                .attr("stroke-width", 2)
                .attr("stroke", "white");
            
            tooltip.style("visibility", "hidden");
        });
        
    
    // 添加标签
    arcs.append("text")
        .attr("transform", d => `translate(${arc.centroid(d)})`)
        .attr("dy", "0.35em")
        .text(d => d.data.Songs)
        .style("text-anchor", "middle")
        .style("font-size", "12px")
        .style("font-weight", "bold")
        .style("fill", "white");
    
    // 添加图例
    const legend = d3.select("#pie-chart")
    .append("div")
    .attr("class", "legend")
    .style("display", "grid")
    .style("grid-template-columns", "repeat(3, 1fr)") // 改为3列
    .style("gap", "6px") // 缩小间隙
    // .style("margin-top", "20px")
    .style("position", "absolute") // 新增
    .style("bottom", "20px") // 新增 - 放到底部
    .style("left", "0") // 新增
    .style("right", "0") // 新增
    .style("padding", "0 20px"); // 新增 - 左右留白
    
    const legendItems = legend.selectAll(".legend-item")
        .data(data)
        .enter()
        .append("div")
        .attr("class", "legend-item")
        .style("display", "flex")
        .style("align-items", "center")
        .style("font-size", "12px");
    
    legendItems.append("div")
        .style("width", "12px")
        .style("height", "12px")
        .style("background-color", d => color(d.Title))
        .style("margin-right", "5px");
    
    legendItems.append("div")
        .text(d => `${d.Title} (${d.Songs})`);
}

function createBarChart(data) {
    let margin = {top: 20, right: 30, bottom: 40, left: 90};
    let width = 500 - margin.left - margin.right;
    let height = 400 - margin.top - margin.bottom;

    if (window.innerWidth < 768) {
        width = width / 2;
        height = height / 2;
        margin = {top: 8, right: 8, bottom: 8, left: 90};
    }
    
    const svg = d3.select("#bar-chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);
    
    // 颜色比例尺
    const color = d3.scaleOrdinal()
    .domain(data.map(d => d.Title))
    .range(data.map(d => albumColors[d.Title] || "#999999"));
    
    // X轴比例尺
    const x = d3.scaleLinear()
        .domain([0, d3.max(data, d => d.Songs)])
        .range([0, width]);
    
    // Y轴比例尺
    const y = d3.scaleBand()
        .domain(data.map(d => d.Title))
        .range([0, height])
        .padding(0.2);
    
    // 添加条形
    svg.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("y", d => y(d.Title))
        .attr("width", 0)
        .attr("height", y.bandwidth())
        .attr("fill", d => color(d.Title))
        // .transition()
        // .duration(1000)
        .attr("width", d => x(d.Songs))
        .on("mouseover", function(event, d) {
            d3.select(this).attr("opacity", 0.8);
            tooltip.html(`${d.Title}<br>${d.Songs}首`)
                .style("visibility", "visible");
        })
        .on("mousemove", function(event) {
            tooltip.style("top", `${event.pageY - 10}px`)
                .style("left", `${event.pageX + 10}px`);
        })
        .on("mouseout", function() {
            d3.select(this).attr("opacity", 1);
            tooltip.style("visibility", "hidden");
        });
    
    // 添加数值标签
    svg.selectAll(".label")
        .data(data)
        .enter()
        .append("text")
        .attr("class", "label")
        .attr("x", d => x(d.Songs) + 5)
        .attr("y", d => y(d.Title) + y.bandwidth()/2)
        .attr("dy", "0.35em")
        .text(d => d.Songs)
        .style("font-size", "12px")
        .style("fill", "#333");
    
    // 添加Y轴
    svg.append("g")
        .call(d3.axisLeft(y).tickSize(0))
        .selectAll("text")
        .style("font-size", "12px");
    
    // 添加X轴
    svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x).ticks(5))
        .selectAll("text")
        .style("font-size", "12px");

    svg.append("text")
    .attr("x", width / 2)
    .attr("y", height + margin.bottom - 2)  // 放在X轴下方
    .attr("text-anchor", "middle")
    .style("font-size", "18px")
    .style("font-weight", "bold")
    .text(`共 ${d3.sum(data, d => d.Songs)} 首歌曲`);
}
    </script>
</body>
</html>
